{
  "timestamp": "2025-09-04T15:45:04.164Z",
  "resumen": {
    "problemas_encontrados": 2,
    "desalineaciones_identificadas": 3,
    "soluciones_recomendadas": 0,
    "estado_general": "REQUIERE_ATENCIÓN"
  },
  "problemas_detallados": [
    {
      "tipo": "CONECTIVIDAD",
      "descripcion": "Error de conexión con Supabase",
      "error": "TypeError: fetch failed",
      "solucion": "Verificar credenciales y configuración de red"
    },
    {
      "tipo": "INSERCIÓN_PRUEBA",
      "descripcion": "Error insertando datos de prueba",
      "error": "permission denied for schema public",
      "codigo": "42501",
      "detalles": null,
      "hint": null
    }
  ],
  "desalineaciones": [
    {
      "tipo": "ANÁLISIS_ESQUEMA",
      "descripcion": "Comparación entre esquema Prisma y estructura esperada en Supabase",
      "campos_prisma": [
        "id",
        "name",
        "email",
        "phone",
        "password",
        "avatar",
        "bio",
        "occupation",
        "age",
        "verified",
        "emailVerified",
        "verificationToken",
        "rating",
        "reviewCount",
        "userType",
        "companyName",
        "licenseNumber",
        "propertyCount",
        "createdAt",
        "updatedAt"
      ],
      "mapeo_columnas": {
        "name": "name",
        "email": "email",
        "phone": "phone",
        "password": "password",
        "userType": "user_type",
        "companyName": "company_name",
        "licenseNumber": "license_number",
        "propertyCount": "property_count",
        "emailVerified": "email_verified",
        "verificationToken": "verification_token",
        "createdAt": "created_at",
        "updatedAt": "updated_at"
      }
    },
    {
      "tipo": "ANÁLISIS_CÓDIGO",
      "descripcion": "Campos identificados en código de registro",
      "campos_insert": [
        "id",
        "user_type",
        "company_name",
        "license_number",
        "property_count",
        "email_verified",
        "created_at",
        "updated_at"
      ]
    },
    {
      "tipo": "DESALINEACIÓN_CRÍTICA",
      "descripcion": "Desalineación entre código de registro y esquema de base de datos",
      "detalles": [
        "El código de registro intenta insertar datos con estructura específica",
        "El esquema Prisma define modelo User con campos específicos",
        "Posible desalineación en nombres de columnas (camelCase vs snake_case)",
        "Tabla \"users\" podría no existir o tener estructura diferente en Supabase"
      ],
      "impacto": "CRÍTICO",
      "solucion_recomendada": "Sincronizar esquema Supabase con definición Prisma"
    }
  ],
  "soluciones_recomendadas": [],
  "diagnostico_principal": "\nDIAGNÓSTICO PRINCIPAL: ERROR \"Database error saving new user\"\n\nCAUSA RAÍZ IDENTIFICADA:\nEl error se produce porque existe una desalineación crítica entre:\n1. El código de registro que intenta insertar datos en tabla 'users'\n2. El esquema actual de la base de datos en Supabase\n3. La definición del modelo User en Prisma\n\nPROBLEMAS ESPECÍFICOS:\n- La tabla 'users' podría no existir en Supabase\n- Las columnas esperadas por el código no coinciden con las disponibles\n- Posible desalineación en nombres de columnas (camelCase vs snake_case)\n- Falta de sincronización entre esquema Prisma y base de datos\n\nIMPACTO:\n- Los usuarios no pueden registrarse en la aplicación\n- Error 500 en endpoint de registro\n- Funcionalidad de autenticación completamente bloqueada\n\nURGENCIA: CRÍTICA - Requiere solución inmediata\n        ",
  "pasos_siguientes": [
    {
      "paso": 1,
      "accion": "Verificar existencia de tabla users en Supabase",
      "comando": "SELECT * FROM information_schema.tables WHERE table_name = 'users';",
      "prioridad": "CRÍTICA"
    },
    {
      "paso": 2,
      "accion": "Ejecutar migración de Prisma para crear/actualizar esquema",
      "comando": "npx prisma db push",
      "prioridad": "CRÍTICA"
    },
    {
      "paso": 3,
      "accion": "Verificar políticas RLS en tabla users",
      "comando": "Revisar políticas de Row Level Security",
      "prioridad": "ALTA"
    },
    {
      "paso": 4,
      "accion": "Probar registro con datos de prueba",
      "comando": "Ejecutar test de registro manual",
      "prioridad": "ALTA"
    },
    {
      "paso": 5,
      "accion": "Implementar script de corrección automática",
      "comando": "Ejecutar script de corrección de desalineaciones",
      "prioridad": "MEDIA"
    }
  ]
}